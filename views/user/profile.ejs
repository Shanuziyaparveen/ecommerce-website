<%- include("../../views/partials/user/header") %>
<style>
 .card-green {
   background-color: #c28ebc;
 }
 .main {
   padding: 30px 0;
 }


 .dashboard-menu {
   background-color: #f1d8ee;
   border-radius: 10px;
   padding: 15px;
   box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
 }


 .dashboard-menu .nav-link {
 font-weight: bold;
 color: #30062d;
 box-shadow: 0 4px 10px rgba(161, 119, 148, 0.3), 0 4px 20px rgba(121, 178, 197, 0.2);
 transition: box-shadow 0.3s ease;
}


.dashboard-menu .nav-link:hover {
 color: #400840;
 box-shadow: 0 4px 15px rgba(198, 59, 213, 0.5), 0 6px 25px rgba(0, 191, 255, 0.4);
}


 .card {
   border-radius: 10px;
   box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
   margin-bottom: 20px;
 }


 .card-header {
   background-color: #6b1e3e;
   color: white;
   border-radius: 10px 10px 0 0;
 }


 .btn-success {
   background-color: #a739a7;
   border-color: #7b136d;
 }


 .btn-success:hover {
   background-color: #5a1e5a;
 }


 .form-group {
   margin-bottom: 15px;
 }


 .required {
   color: red;
 }


  @media (max-width: 768px) {
   .dashboard-menu {
     padding: 10px;
   }


   .card {
     margin-bottom: 15px;
   }
 }
 .page-header.breadcrumb-wrap {
 background-color: #efc5dd;
 padding: 15px 0;
}


.breadcrumb {
 display: flex;
 align-items: center;
 font-family: 'Arial', sans-serif;
 font-size: 16px;
 color: #121311;
}


.breadcrumb a {
 color: #30063a;
 text-decoration: none;
 position: relative;
 margin: 0 5px;
}


.breadcrumb a:hover {
 color: #e6a2f1;
}


.breadcrumb span {
 margin: 0 5px;
 color: #999;
}


.breadcrumb a::after {
 content: '';
 position: absolute;
 width: 100%;
 height: 2px;
 background: #612f69;
 left: 0;
 bottom: -2px;
 transform: scaleX(0);
 transition: transform 0.3s ease;
}


.breadcrumb a:hover::after {
 transform: scaleX(1);
}
/* Style for the pagination container */
.pagination {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 10px;
  margin-top: 20px;
}

/* Style for each pagination button */
.pagination a, .pagination span {
  padding: 8px 16px;
  font-size: 16px;
  color: #ffffff;
  background-color: #007bff; /* Primary color */
  border: 1px solid #007bff;
  border-radius: 5px;
  cursor: pointer;
  text-decoration: none;
  transition: background-color 0.3s, transform 0.3s;
}

/* Hover effect */
.pagination a:hover {
  background-color: #0056b3; /* Darker shade of primary color */
  transform: translateY(-2px); /* Slight lift effect */
}

/* Active page button */
.pagination .btn-primary {
  background-color: #0056b3; /* Active page has the darker primary color */
  border-color: #0056b3;
}

/* Disabled button (no hover effect) */
.pagination .disabled {
  background-color: #e0e0e0;
  color: #b0b0b0;
  border-color: #e0e0e0;
  cursor: not-allowed;
}

/* Style for the Previous and Next buttons */
.pagination .btn-secondary {
  background-color: #f1f1f1;
  color: #333;
  border-color: #ccc;
}

.pagination .btn-secondary:hover {
  background-color: #ddd;
  transform: translateY(-2px);
}

/* Mobile-friendly adjustments */
@media (max-width: 600px) {
  .pagination {
    gap: 5px;
  }
  .pagination a, .pagination span {
    padding: 6px 12px;
    font-size: 14px;
  }
}

</style>


<main class="main">
 <div class="page-header breadcrumb-wrap mb-3">
   <div class="container">
     <div class="breadcrumb">
       <a href="/" rel="nofollow">Home</a>
       <span></span><a href="/getAllProducts" rel="nofollow">Shop</a><span></span> Account
     </div>
   </div>
 </div>
  <section class="pt-10 pb-10">
   <div class="container">
     <div class="row">
       <div class="col-lg-10 m-auto">
         <div class="row">
           <div class="col-md-4">
             <div class="dashboard-menu">
               <ul class="nav flex-column" role="tablist">
                 <li class="nav-item">
                   <a class="nav-link active" id="dashboard-tab" data-bs-toggle="tab" href="#dashboard" role="tab" aria-controls="dashboard" aria-selected="false">
                     <i class="fi-rs-settings-sliders mr-10"></i>Dashboard
                   </a>
                 </li>
                 <li class="nav-item">
                   <a class="nav-link" id="address-tab" data-bs-toggle="tab" href="#address" role="tab" aria-controls="address" aria-selected="true">
                     <i class="fi-rs-marker mr-10"></i>My Address
                   </a>
                 </li>
                 <li class="nav-item">
                   <a class="nav-link" id="orders-tab" data-bs-toggle="tab" href="#orders" role="tab" aria-controls="orders" aria-selected="false">
                     <i class="fi-rs-shopping-bag mr-10"></i>Orders
                   </a>
                 </li>
                 <li class="nav-item">
                   <a class="nav-link" id="track-orders-tab" data-bs-toggle="tab" href="#track-orders" role="tab" aria-controls="track-orders" aria-selected="false">
                     <i class="fi-rs-shopping-cart-check mr-10"></i>Wallet Status
                   </a>
                 </li>
                 <li class="nav-item">
                   <a class="nav-link" id="track-orders-tab" data-bs-toggle="tab" href="#wallet-history" role="tab" aria-controls="track-orders" aria-selected="false">
                     <i class="fi-rs-shopping-cart-check mr-10"></i>Wallet History
                   </a>
                 </li>
                 <li class="nav-item">
                   <a class="nav-link" id="track-orders-tab" data-bs-toggle="tab" href="#referal" role="tab" aria-controls="track-orders" aria-selected="false">
                     <i class="fi-rs-shopping-cart-check mr-10"></i>Referals
                   </a>
                 </li>
                 <li class="nav-item">
                   <a class="nav-link" href="/logout">
                     <i class="fi-rs-sign-out mr-10"></i>Logout
                   </a>
                 </li>
               </ul>
             </div>
           </div>
           <div class="col-md-8">
             <div class="tab-content dashboard-content">


               <div class="tab-pane fade show active" id="dashboard" role="tabpanel" aria-labelledby="dashboard-tab">
                 <div class="card card-green">
                   <div class="card-header">
                     <h5 class="mb-0 text-center">User Profile</h5>
                   </div>
                   <div class="card-body text-center">
                     <h5 class="card-title"><%=user.name%></h5>
                     <p class="card-text">
                       <strong>Phone:</strong><%=user.phone%>
                     </p>
                     <p class="card-text">
                       <strong>Email:</strong><%=user.email%>
                     </p>
                     <a href="/change-email" class="btn btn-sm btn-success ml-2">Change Email</a>
                     <a href="/change-password" class="btn btn-sm btn-success">Change Password</a>
                   </div>
                 </div>
               </div>


               <div
                 class="tab-pane fade"
                 id="address"
                 role="tabpanel"
                 aria-labelledby="address-tab"
               >
                 <div class="row">
                <%if(userAddress){%>

                  <%userAddress.address.forEach((address)=>{%>
                   <div class="col-lg-6">
                     <div class="card mb-3 mb-lg-0">
                       <div class="card-header">
                         <h5 class="mb-0"></h5>
                       </div>


                       <div class="card-body">
                         <address>
                          <h1><%=address.addressType%></h1>
                       <h3> <%=address.name%></h3><br>
                        <%=address.street%><br>
                        <%=address.landMark%><br>

                        <%=address.city%><br>
                        
                        <%=address.state%>
                        
                         </address>
                         <p><%=address.pincode%></p>
                         <p><%=address.phone%></p>
                         <p><%=address.altPhone%></p>
                         <div class="d-flex justify-content-between">
                           <a href="/editAddress?id=<%=address._id%>" class="btn-small">Edit</a>
                           <a href="/deleteAddress?id=<%=address._id%>" class="btn-small" onclick="return confirm ('are you sure you wanted to delete?')">Delete</a>
                         </div>
                        
                       </div>
                     </div>
                   </div>
                   <%})%>
                <%}else{%>
                   <div class="col-lg-6">
                     <div class="card mb-3 mb-lg-0">
                       <div class="card-header">
                         <h5 class="mb-0"></h5>
                       </div>
                       <div class="card-body">
                         <address>No address</address>
                       </div>
                     </div>
                   </div>
              <%}%>
                   <div>
                     <a href="/addAddress">
                       <button class="btn btn-primary w-70">
                         Add address
                       </button>
                     </a>
                   </div>
                 </div>
               </div>


               <div class="tab-pane fade" id="orders" role="tabpanel" aria-labelledby="orders-tab">
                <div class="row">
                  <% if (orders && orders.length > 0) { %>
                    <div class="col-lg-12">
                      <table class="table table-striped">
                        <thead>
                          <tr>
                            <th>Order ID</th>
                            <th>No. of Items</th>
                            <th>Total Amount</th>
                            <th>Status</th>
                            <th>Action</th>
                          </tr>
                        </thead>
                        <tbody>
                          <% orders.forEach((order) => { %>
                            <tr>
                              <td><%= order.orderId %></td>
                              <td><%= order.orderedItems.length %></td>
                              <td>₹<%= order.finalAmount %></td>
                              <td><span class="badge badge-info"><%= order.status || 'Pending' %></span></td>
                              <td>
                                <a href="/viewOrder/<%= order._id %>" class="btn btn-sm btn-primary">View Details</a>
                              </td>
                            </tr>
                          <% }) %>
                        </tbody>
                      </table>
                      
                      <!-- Orders Pagination -->
                      <div class="pagination" style="display: flex; justify-content: center; gap: 10px; margin-top: 20px;">
                        <% if (currentPage > 1) { %>
                          <a href="/userProfile?page=<%= currentPage - 1 %>" class="btn btn-secondary">Previous</a>
                        <% } else { %>
                          <span class="btn btn-secondary disabled">Previous</span>
                        <% } %>
              
                        <% for (let i = 1; i <= totalPages; i++) { %>
                          <a href="/userProfile?page=<%= i %>" class="btn <%= currentPage === i ? 'btn-primary' : 'btn-light' %>">
                            <%= i %>
                          </a>
                        <% } %>
              
                        <% if (currentPage < totalPages) { %>
                          <a href="/userProfile?page=<%= currentPage + 1 %>" class="btn btn-secondary">Next</a>
                        <% } else { %>
                          <span class="btn btn-secondary disabled">Next</span>
                        <% } %>
                      </div>
                    </div>
                  <% } else { %>
                    <div class="col-lg-12">
                      <div class="card mb-3">
                        <div class="card-header">
                          <h5 class="mb-0">No Orders</h5>
                        </div>
                        <div class="card-body">
                          <p>You have not placed any orders yet.</p>
                        </div>
                      </div>
                    </div>
                  <% } %>
                </div>
              </div>
              
              
              <div class="tab-pane fade" id="track-orders" role="tabpanel" aria-labelledby="track-orders-tab">
                <div class="card">
                  <div class="card-header">
                    <h5 class="mb-0">Wallet</h5>
                  </div>
                  <div class="card-body contact-from-area">
                    <div class="row">
                      <div class="col-lg-8 mx-auto text-center mt-90">
                        <form action="/wallet/add-money" method="POST">
                          <div class="form-group">
                            <label for="walletAmount" class="h4">Current Balance</label>
                            <div class="h3">₹<%= wallet.balance %></div>
                          </div>
                          <div class="form-group">
                            <label for="addAmount" class="h4">Add Amount</label>
                            <input type="number" id="addAmount" name="amount" class="form-control" placeholder="Enter amount" required min="1">
                          </div>
                          <button type="submit" class="btn btn-success">Add Money</button>
                        </form>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="tab-pane fade" id="wallet-history" role="tabpanel" aria-labelledby="wallet-history-tab">
                <div class="card">
                  <div class="card-header">
                    <h5 class="mb-0">Wallet History</h5>
                  </div>
                  <div class="card-body">
                    <div class="table-responsive">
                      <table class="table">
                        <thead>
                          <tr>
                            <th>Date</th>
                            <th>Status</th>
                            <th>Amount</th>
                          </tr>
                        </thead>
                        <tbody>
                          <% if (wallet.transactions && wallet.transactions.length > 0) { %>
                            <% wallet.transactions
                              .sort((a, b) => new Date(b.date) - new Date(a.date))
                              .slice((currentPage - 1) * itemsPerPage, currentPage * itemsPerPage)
                              .forEach(transaction => { %>
                                <tr>
                                  <td><%= new Date(transaction.date).toLocaleDateString() %></td>
                                  <td><%= transaction.type %></td>
                                  <td>₹<%= transaction.amount.toFixed(2) %></td>
                                </tr>
                            <% }) %>
                          <% } else { %>
                            <tr>
                              <td colspan="3" class="text-center">No wallet transactions found</td>
                            </tr>
                          <% } %>
                        </tbody>
                      </table>
              
                      <!-- Pagination Controls -->
                      <div class="pagination" style="display: flex; justify-content: center; gap: 10px; margin-top: 20px;">
                        <% if (currentPage > 1) { %>
                          <a href="/userProfile?page=<%= currentPage - 1 %>&tab=wallet-history" class="btn btn-secondary">Previous</a>
                        <% } else { %>
                          <span class="btn btn-secondary disabled">Previous</span>
                        <% } %>
              
                        <% for (let i = 1; i <= totalPagesTransactions; i++) { %>
                          <a href="/userProfile?page=<%= i %>&tab=wallet-history" class="btn <%= currentPage === i ? 'btn-primary' : 'btn-light' %>">
                            <%= i %>
                          </a>
                        <% } %>
              
                        <% if (currentPage < totalPagesTransactions) { %>
                          <a href="/userProfile?page=<%= currentPage + 1 %>&tab=wallet-history" class="btn btn-secondary">Next</a>
                        <% } else { %>
                          <span class="btn btn-secondary disabled">Next</span>
                        <% } %>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              
              
              <div class="tab-pane fade" id="referal" role="tabpanel" aria-labelledby="track-orders-tab">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">Referral</h5>
                    </div>
                    <div class="card-body">
                        <h6 class="mb-3">Refer your friends and earn rewards!</h6>
                        <p>Share this link: 
                            <strong><%= user.referralCode %></strong>
                        </p>
                        <p>Earned: ₹<%= user.rewards %></p> <!-- Display the rewards earned -->
                    </div>
                </div>
            </div>
            
       </div>
     </div>
   </div>
 </section>


<%- include("../../views/partials/user/footer") %>




